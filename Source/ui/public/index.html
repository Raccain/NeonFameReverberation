<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NeonFameReverberation</title>
  <style>
    /* === NeoGrid Minimal — NeonFameReverberation Production UI === */
    :root {
      --bg:         #111115;
      --surface:    #1E1E24;
      --surface-hl: #2A2A33;
      --primary:    #00FFFF;
      --text:       #F0F0F5;
      --muted:      #A0A0B0;
      --border:     #333340;
      --radius:     4px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    html, body {
      width: 680px; height: 280px;
      overflow: hidden;
      background: var(--bg);
      font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
    }

    /* === Plugin Shell === */
    .plugin {
      width: 680px; height: 280px;
      background: linear-gradient(160deg, var(--surface) 0%, var(--bg) 100%);
      border: 1px solid var(--border);
      border-top: 3px solid var(--primary);
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
      user-select: none;
    }

    /* Corner screws */
    .screw {
      position: absolute;
      width: 10px; height: 10px;
      background: #0d0d12;
      border: 1px solid #2a2a35;
      border-radius: 50%;
      z-index: 10;
    }
    .screw::after {
      content: '';
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%,-50%) rotate(45deg);
      width: 60%; height: 1px; background: #3a3a45;
    }
    .s-tl { top:8px; left:8px; }   .s-tr { top:8px; right:8px; }
    .s-bl { bottom:8px; left:8px; } .s-br { bottom:8px; right:8px; }

    /* === Header === */
    .header {
      height: 44px; padding: 0 28px;
      display: flex; align-items: center; justify-content: space-between;
      border-bottom: 1px solid rgba(255,255,255,0.04);
      flex-shrink: 0;
    }
    .plugin-name {
      font-size: 14px; font-weight: 700;
      letter-spacing: 0.18em; text-transform: uppercase; color: var(--text);
    }
    .plugin-name em { color: var(--primary); font-style: normal; }
    .plugin-sub {
      font-size: 10px; font-weight: 500;
      letter-spacing: 0.22em; text-transform: uppercase;
      color: var(--muted); opacity: 0.5;
    }

    /* === Body === */
    .body {
      flex: 1; padding: 12px 20px;
      display: flex; gap: 12px; align-items: stretch; min-height: 0;
    }

    .panel {
      background: rgba(0,0,0,0.18);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 8px 12px 6px;
      display: flex; flex-direction: column;
    }
    .panel-label {
      font-size: 9px; font-weight: 700;
      letter-spacing: 0.22em; text-transform: uppercase;
      color: var(--muted); opacity: 0.5; margin-bottom: 6px; flex-shrink: 0;
    }
    .panel-controls {
      flex: 1; display: flex; gap: 8px;
      align-items: center; justify-content: center;
    }

    .panel-input  { width: 88px; flex-shrink: 0; }
    .panel-spring { flex: 1; }
    .panel-output { width: 88px; flex-shrink: 0; }

    /* === Knob Component === */
    .knob-wrap {
      display: flex; flex-direction: column; align-items: center;
      gap: 4px; cursor: ns-resize; width: 68px; flex-shrink: 0;
      -webkit-user-select: none; user-select: none;
    }
    .knob-svg {
      width: 52px; height: 52px; overflow: visible;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
      transition: filter 0.1s;
      pointer-events: none;
    }
    .knob-label {
      font-size: 9px; font-weight: 700;
      letter-spacing: 0.12em; text-transform: uppercase;
      color: var(--muted); text-align: center; transition: color 0.15s;
    }
    .knob-value {
      font-size: 9px; font-family: 'Courier New', monospace;
      color: var(--primary); letter-spacing: 0.04em;
      opacity: 0.75; min-height: 11px; text-align: center;
    }
    .knob-wrap:hover .knob-label  { color: var(--text); }
    .knob-wrap.dragging .knob-svg { filter: drop-shadow(0 0 6px rgba(0,255,255,0.6)) drop-shadow(0 2px 4px rgba(0,0,0,0.5)); }
    .knob-wrap.dragging .knob-label { color: var(--primary); }
    .knob-wrap.dragging .knob-value { opacity: 1; }

    /* === Footer === */
    .footer {
      height: 24px; padding: 0 24px;
      display: flex; align-items: center; justify-content: space-between;
      background: rgba(0,0,0,0.15);
      border-top: 1px solid rgba(255,255,255,0.03);
      flex-shrink: 0;
    }
    .footer span {
      font-size: 9px; font-family: 'Courier New', monospace;
      letter-spacing: 0.12em; text-transform: uppercase;
      color: var(--muted); opacity: 0.3;
    }
    #debug-log { opacity: 1 !important; color: #ff0 !important; }
  </style>
</head>
<body>

<div class="plugin">
  <div class="screw s-tl"></div><div class="screw s-tr"></div>
  <div class="screw s-bl"></div><div class="screw s-br"></div>

  <div class="header">
    <div class="plugin-name"><em>NEONFAME</em>REVERBERATION</div>
    <div class="plugin-sub">Spring Reverb</div>
  </div>

  <div class="body">

    <!-- INPUT: Drive -->
    <div class="panel panel-input">
      <div class="panel-label">Input</div>
      <div class="panel-controls">
        <div class="knob-wrap" id="knob-drive" data-param="drive" data-min="0" data-max="1" data-default="0.2" data-unit="">
          <svg class="knob-svg" viewBox="0 0 64 64">
            <path d="M12.2 51.8 A28 28 0 1 1 51.8 51.8" fill="none" stroke="#2A2A33" stroke-width="7" stroke-linecap="round"/>
            <circle class="value-arc" cx="32" cy="32" r="28" fill="none" stroke="#00FFFF" stroke-width="7" stroke-linecap="round" transform="rotate(135 32 32)" stroke-dasharray="0 175.93"/>
            <circle cx="32" cy="32" r="3" fill="#00FFFF" opacity="0.35"/>
          </svg>
          <div class="knob-label">Drive</div>
          <div class="knob-value">—</div>
        </div>
      </div>
    </div>

    <!-- SPRING: Pre-Delay, Tension, Decay, Damping, Wobble -->
    <div class="panel panel-spring">
      <div class="panel-label">Spring</div>
      <div class="panel-controls">

        <div class="knob-wrap" id="knob-pre_delay" data-param="pre_delay" data-min="0" data-max="100" data-default="10" data-unit="ms">
          <svg class="knob-svg" viewBox="0 0 64 64">
            <path d="M12.2 51.8 A28 28 0 1 1 51.8 51.8" fill="none" stroke="#2A2A33" stroke-width="7" stroke-linecap="round"/>
            <circle class="value-arc" cx="32" cy="32" r="28" fill="none" stroke="#00FFFF" stroke-width="7" stroke-linecap="round" transform="rotate(135 32 32)" stroke-dasharray="0 175.93"/>
            <circle cx="32" cy="32" r="3" fill="#00FFFF" opacity="0.35"/>
          </svg>
          <div class="knob-label">Pre-Dly</div>
          <div class="knob-value">—</div>
        </div>

        <div class="knob-wrap" id="knob-tension" data-param="tension" data-min="0" data-max="1" data-default="0.5" data-unit="">
          <svg class="knob-svg" viewBox="0 0 64 64">
            <path d="M12.2 51.8 A28 28 0 1 1 51.8 51.8" fill="none" stroke="#2A2A33" stroke-width="7" stroke-linecap="round"/>
            <circle class="value-arc" cx="32" cy="32" r="28" fill="none" stroke="#00FFFF" stroke-width="7" stroke-linecap="round" transform="rotate(135 32 32)" stroke-dasharray="0 175.93"/>
            <circle cx="32" cy="32" r="3" fill="#00FFFF" opacity="0.35"/>
          </svg>
          <div class="knob-label">Tension</div>
          <div class="knob-value">—</div>
        </div>

        <div class="knob-wrap" id="knob-decay" data-param="decay" data-min="0.1" data-max="8" data-default="2" data-unit="s">
          <svg class="knob-svg" viewBox="0 0 64 64">
            <path d="M12.2 51.8 A28 28 0 1 1 51.8 51.8" fill="none" stroke="#2A2A33" stroke-width="7" stroke-linecap="round"/>
            <circle class="value-arc" cx="32" cy="32" r="28" fill="none" stroke="#00FFFF" stroke-width="7" stroke-linecap="round" transform="rotate(135 32 32)" stroke-dasharray="0 175.93"/>
            <circle cx="32" cy="32" r="3" fill="#00FFFF" opacity="0.35"/>
          </svg>
          <div class="knob-label">Decay</div>
          <div class="knob-value">—</div>
        </div>

        <div class="knob-wrap" id="knob-damping" data-param="damping" data-min="0" data-max="1" data-default="0.4" data-unit="">
          <svg class="knob-svg" viewBox="0 0 64 64">
            <path d="M12.2 51.8 A28 28 0 1 1 51.8 51.8" fill="none" stroke="#2A2A33" stroke-width="7" stroke-linecap="round"/>
            <circle class="value-arc" cx="32" cy="32" r="28" fill="none" stroke="#00FFFF" stroke-width="7" stroke-linecap="round" transform="rotate(135 32 32)" stroke-dasharray="0 175.93"/>
            <circle cx="32" cy="32" r="3" fill="#00FFFF" opacity="0.35"/>
          </svg>
          <div class="knob-label">Damping</div>
          <div class="knob-value">—</div>
        </div>

        <div class="knob-wrap" id="knob-wobble" data-param="wobble" data-min="0" data-max="1" data-default="0.3" data-unit="">
          <svg class="knob-svg" viewBox="0 0 64 64">
            <path d="M12.2 51.8 A28 28 0 1 1 51.8 51.8" fill="none" stroke="#2A2A33" stroke-width="7" stroke-linecap="round"/>
            <circle class="value-arc" cx="32" cy="32" r="28" fill="none" stroke="#00FFFF" stroke-width="7" stroke-linecap="round" transform="rotate(135 32 32)" stroke-dasharray="0 175.93"/>
            <circle cx="32" cy="32" r="3" fill="#00FFFF" opacity="0.35"/>
          </svg>
          <div class="knob-label">Wobble</div>
          <div class="knob-value">—</div>
        </div>

      </div>
    </div>

    <!-- OUTPUT: Mix -->
    <div class="panel panel-output">
      <div class="panel-label">Output</div>
      <div class="panel-controls">
        <div class="knob-wrap" id="knob-mix" data-param="mix" data-min="0" data-max="1" data-default="0.5" data-unit="%">
          <svg class="knob-svg" viewBox="0 0 64 64">
            <path d="M12.2 51.8 A28 28 0 1 1 51.8 51.8" fill="none" stroke="#2A2A33" stroke-width="7" stroke-linecap="round"/>
            <circle class="value-arc" cx="32" cy="32" r="28" fill="none" stroke="#00FFFF" stroke-width="7" stroke-linecap="round" transform="rotate(135 32 32)" stroke-dasharray="0 175.93"/>
            <circle cx="32" cy="32" r="3" fill="#00FFFF" opacity="0.35"/>
          </svg>
          <div class="knob-label">Mix</div>
          <div class="knob-value">—</div>
        </div>
      </div>
    </div>

  </div><!-- /.body -->

  <div class="footer">
    <span>NeonFameReverberation v1.0.5</span>
    <span id="debug-log">ready</span>
  </div>
</div>

<script>
// =============================================================================
// JUCE Native Interop (inlined from juce/check_native_interop.js)
// =============================================================================
(function() {
  if (typeof window.__JUCE__ !== "undefined" &&
      typeof window.__JUCE__.getAndroidUserScripts !== "undefined" &&
      typeof window.inAndroidUserScriptEval === "undefined") {
    window.inAndroidUserScriptEval = true;
    eval(window.__JUCE__.getAndroidUserScripts());
    delete window.inAndroidUserScriptEval;
  }

  if (typeof window.__JUCE__ === "undefined") {
    window.__JUCE__ = { postMessage: function() {} };
  }

  if (typeof window.__JUCE__.initialisationData === "undefined") {
    window.__JUCE__.initialisationData = {
      __juce__platform: [], __juce__functions: [],
      __juce__registeredGlobalEventIds: [],
      __juce__sliders: [], __juce__toggles: [], __juce__comboBoxes: []
    };
  }

  class ListenerList {
    constructor() { this.listeners = new Map(); this.listenerId = 0; }
    addListener(fn) { const id = this.listenerId++; this.listeners.set(id, fn); return id; }
    removeListener(id) { this.listeners.delete(id); }
    callListeners(p) { for (const [, v] of this.listeners) v(p); }
  }

  class EventListenerList {
    constructor() { this.eventListeners = new Map(); }
    addEventListener(eventId, fn) {
      if (!this.eventListeners.has(eventId))
        this.eventListeners.set(eventId, new ListenerList());
      const id = this.eventListeners.get(eventId).addListener(fn);
      return [eventId, id];
    }
    removeEventListener([eventId, id]) {
      if (this.eventListeners.has(eventId))
        this.eventListeners.get(eventId).removeListener(id);
    }
    emitEvent(eventId, object) {
      if (this.eventListeners.has(eventId))
        this.eventListeners.get(eventId).callListeners(object);
    }
  }

  class Backend {
    constructor() { this.listeners = new EventListenerList(); }
    addEventListener(eventId, fn) { return this.listeners.addEventListener(eventId, fn); }
    removeEventListener(handle) { this.listeners.removeEventListener(handle); }
    emitEvent(eventId, object) {
      window.__JUCE__.postMessage(JSON.stringify({ eventId: eventId, payload: object }));
    }
    emitByBackend(eventId, object) { this.listeners.emitEvent(eventId, JSON.parse(object)); }
  }

  if (typeof window.__JUCE__.backend === "undefined")
    window.__JUCE__.backend = new Backend();
})();

// =============================================================================
// JUCE SliderState (inlined from juce/index.js)
// =============================================================================
(function() {
  const BasicControl_valueChangedEventId    = "valueChanged";
  const BasicControl_propertiesChangedId    = "propertiesChanged";
  const SliderControl_sliderDragStartedId   = "sliderDragStarted";
  const SliderControl_sliderDragEndedId     = "sliderDragEnded";

  class ListenerList {
    constructor() { this.listeners = new Map(); this.listenerId = 0; }
    addListener(fn) { const id = this.listenerId++; this.listeners.set(id, fn); return id; }
    removeListener(id) { this.listeners.delete(id); }
    callListeners(p) { for (const [, v] of this.listeners) v(p); }
  }

  class SliderState {
    constructor(name) {
      this.name = name;
      this.identifier = "__juce__slider" + name;
      this.scaledValue = 0;
      this.properties = { start: 0, end: 1, skew: 1, name: "", label: "",
                          numSteps: 100, interval: 0, parameterIndex: -1 };
      this.valueChangedEvent = new ListenerList();
      this.propertiesChangedEvent = new ListenerList();

      window.__JUCE__.backend.addEventListener(this.identifier,
        (event) => this.handleEvent(event));
      window.__JUCE__.backend.emitEvent(this.identifier,
        { eventType: "requestInitialUpdate" });
    }

    setNormalisedValue(newValue) {
      this.scaledValue = this.snapToLegalValue(this.normalisedToScaledValue(newValue));
      window.__JUCE__.backend.emitEvent(this.identifier,
        { eventType: BasicControl_valueChangedEventId, value: this.scaledValue });
    }

    sliderDragStarted() {
      window.__JUCE__.backend.emitEvent(this.identifier,
        { eventType: SliderControl_sliderDragStartedId });
    }

    sliderDragEnded() {
      window.__JUCE__.backend.emitEvent(this.identifier,
        { eventType: SliderControl_sliderDragEndedId });
    }

    handleEvent(event) {
      if (event.eventType === BasicControl_valueChangedEventId) {
        this.scaledValue = event.value;
        this.valueChangedEvent.callListeners();
      }
      if (event.eventType === BasicControl_propertiesChangedId) {
        const { eventType, ...rest } = event;
        this.properties = rest;
        this.propertiesChangedEvent.callListeners();
      }
    }

    getScaledValue() { return this.scaledValue; }

    getNormalisedValue() {
      return Math.pow(
        (this.scaledValue - this.properties.start) /
        (this.properties.end - this.properties.start),
        this.properties.skew);
    }

    normalisedToScaledValue(v) {
      return Math.pow(v, 1 / this.properties.skew) *
        (this.properties.end - this.properties.start) + this.properties.start;
    }

    snapToLegalValue(value) {
      const interval = this.properties.interval;
      if (interval === 0) return value;
      const start = this.properties.start;
      const clamp = (v, mn, mx) => Math.max(mn, Math.min(mx, v));
      return clamp(start + interval * Math.floor((value - start) / interval + 0.5),
        this.properties.start, this.properties.end);
    }
  }

  const sliderStates = new Map();
  for (const name of window.__JUCE__.initialisationData.__juce__sliders)
    sliderStates.set(name, new SliderState(name));

  window.__NFR_getSliderState = function(name) {
    if (!sliderStates.has(name)) sliderStates.set(name, new SliderState(name));
    return sliderStates.get(name);
  };
})();

// =============================================================================
// NeonFameReverberation — Knob UI
// =============================================================================
(function() {
  function dbg(msg) {
    var el = document.getElementById('debug-log');
    if (el) el.textContent = msg;
  }

  const ARC_CIRC  = 175.929;
  const ARC_SWEEP = 131.947;

  class KnobBinding {
    constructor(el) {
      this.el      = el;
      this.param   = el.dataset.param;
      this.min     = parseFloat(el.dataset.min);
      this.max     = parseFloat(el.dataset.max);
      this.defVal  = parseFloat(el.dataset.default);
      this.unit    = el.dataset.unit || "";
      this.arc     = el.querySelector(".value-arc");
      this.display = el.querySelector(".knob-value");
      this.state   = window.__NFR_getSliderState(this.param);
      this.dragging  = false;
      this.startY    = 0;
      this.startNorm = 0;

      this.state.valueChangedEvent.addListener(() => this._onBackendChange());
      el.addEventListener("mousedown", (e) => this._onDown(e));
      el.addEventListener("dblclick",  () => this._reset());
      this._onBackendChange();
    }

    _onBackendChange() {
      this._renderNorm(this.state.getNormalisedValue());
    }

    _onDown(e) {
      dbg("DOWN: " + this.param);
      this.dragging  = true;
      this.startY    = e.clientY;
      this.startNorm = this.state.getNormalisedValue();
      this.el.classList.add("dragging");
      this.state.sliderDragStarted();
      e.preventDefault();
    }

    onMove(e) {
      if (!this.dragging) return;
      var dy   = this.startY - e.clientY;
      var norm = Math.max(0, Math.min(1, this.startNorm + dy / 180));
      this.state.setNormalisedValue(norm);
      this._renderNorm(norm);
    }

    onUp() {
      if (!this.dragging) return;
      this.dragging = false;
      this.el.classList.remove("dragging");
      this.state.sliderDragEnded();
    }

    _reset() {
      var norm = (this.defVal - this.min) / (this.max - this.min);
      this.state.setNormalisedValue(norm);
      this._renderNorm(norm);
    }

    _renderNorm(norm) {
      var len = norm * ARC_SWEEP;
      var gap = ARC_CIRC - len;
      this.arc.setAttribute("stroke-dasharray", len.toFixed(3) + " " + gap.toFixed(3));
      this.display.textContent = this._fmt(this.state.getScaledValue());
    }

    _fmt(v) {
      switch (this.unit) {
        case "ms": return Math.round(v) + "ms";
        case "s":  return v.toFixed(2) + "s";
        case "%":  return Math.round(v * 100) + "%";
        default:   return v.toFixed(2);
      }
    }
  }

  document.addEventListener("DOMContentLoaded", function() {
    var knobEls = document.querySelectorAll(".knob-wrap");
    dbg(knobEls.length + " knobs");
    var bindings = Array.from(knobEls).map(function(el) { return new KnobBinding(el); });
    document.addEventListener("mousemove", function(e) { bindings.forEach(function(b) { b.onMove(e); }); });
    document.addEventListener("mouseup",   function()  { bindings.forEach(function(b) { b.onUp(); }); });
    dbg("ready");
  });
})();
</script>

</body>
</html>
